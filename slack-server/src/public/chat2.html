<meta http-equiv="Content-Security-Policy"
    content="default-src *; style-src 'self' http://* 'unsafe-inline'; script-src 'self' http://* 'unsafe-inline' 'unsafe-eval'" />

<script src="/socket.io/socket.io.js"></script>
<script>    
    const mainSocket = io.connect();
    let namespaceList = [];
    let roomList = [];
    mainSocket.on('mainSocketMsg' , mainSocketMsg => {
        console.log("Message from mainSocket" , mainSocketMsg)
        if(mainSocketMsg.message.type === 'namespaceList'){
            namespaceList=mainSocketMsg.message.data;
            console.log("namespaceList:" , namespaceList); 
            if(namespaceList.length > 0){
                // namespaceList.forEach( namespace => {    
                //     console.log("Connecting NS:" , namespace); 
                //     const NSSocket = io.connect(`/${namespace.name}`);
                //     NSSocket.on(`${namespace.name}NSMsg`, msg => {
                //         console.log("Msg from ${namespace.name} NS: ", msg);
                //     })
                // });
                joinNamespace(namespaceList[0].name);
            }    
        }
    });
    const joinNamespace = ( namespaceName ) => {
        console.log("Request to join ", namespaceName);
        const nsToJoin = namespaceList.filter((ns) => ns.name === namespaceName);
        const NSSocket = io.connect(`/${namespaceName}`);
        console.log("Connecting to ", namespaceName, " namespace");
        NSSocket.on(`${namespaceName}NSMsg`, msg => {
            console.log("Msg from ${namespace.name} NS: ", msg);
            if(msg.data && msg.data.rooms.length > 0){
                roomList = msg.data.rooms;
                console.log("Fetched Rooms: " , roomList);
            }
        })
    }
   
</script>